// Generated by CoffeeScript 1.4.0
var ApprovedDrugClinicalCandidateList;

ApprovedDrugClinicalCandidateList = PaginatedCollection.extend(DownloadModelOrCollectionExt).extend({
  model: ApprovedDrugClinicalCandidate,
  setURL: function(chembl_id) {
    return this.url = Settings.WS_BASE_URL + 'mechanism.json?target_chembl_id=' + chembl_id;
  },
  fetch: function() {
    var base_url2, drug_mechanisms, getDrugMechanisms, this_collection;
    this_collection = this;
    drug_mechanisms = {};
    getDrugMechanisms = $.getJSON(this.url, function(data) {
      return drug_mechanisms = data.mechanisms;
    });
    getDrugMechanisms.fail(function() {
      console.log('error');
      return this_collection.trigger('error');
    });
    base_url2 = Settings.WS_BASE_URL + 'molecule.json?molecule_chembl_id__in=';
    return getDrugMechanisms.done(function() {
      var dm, getMoleculesInfo, getMoleculesInfoUrl, molecules_list;
      molecules_list = ((function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = drug_mechanisms.length; _i < _len; _i++) {
          dm = drug_mechanisms[_i];
          _results.push(dm.molecule_chembl_id);
        }
        return _results;
      })()).join(',');
      getMoleculesInfoUrl = base_url2 + molecules_list + '&order_by=molecule_chembl_id&limit=1000';
      getMoleculesInfo = $.getJSON(getMoleculesInfoUrl, function(data) {
        var i, mol, molecules, _i, _len;
        molecules = data.molecules;
        i = 0;
        for (_i = 0, _len = molecules.length; _i < _len; _i++) {
          mol = molecules[_i];
          drug_mechanisms[i].max_phase = mol.max_phase;
          drug_mechanisms[i].pref_name = mol.pref_name;
          i++;
        }
        return this_collection.reset(drug_mechanisms);
      });
      return getMoleculesInfo.fail(function() {
        return console.log('failed2');
      });
    });
  },
  initialize: function() {
    this.meta = {
      page_size: 10,
      current_page: 1,
      available_page_sizes: Settings.TABLE_PAGE_SIZES,
      to_show: [],
      columns: [
        {
          'name_to_show': 'ChEMBL ID',
          'comparator': 'molecule_chembl_id',
          'sort_disabled': false,
          'is_sorting': 0,
          'sort_class': 'fa-sort',
          'link_base': '/compound_report_card/$$$'
        }, {
          'name_to_show': 'Name',
          'comparator': 'pref_name',
          'sort_disabled': false,
          'is_sorting': 0,
          'sort_class': 'fa-sort'
        }, {
          'name_to_show': 'Mechanism of Action',
          'comparator': 'mechanism_of_action',
          'sort_disabled': false,
          'is_sorting': 0,
          'sort_class': 'fa-sort'
        }, {
          'name_to_show': 'Max Phase',
          'comparator': 'max_phase',
          'sort_disabled': false,
          'is_sorting': 0,
          'sort_class': 'fa-sort'
        }, {
          'name_to_show': 'References',
          'comparator': 'references',
          'sort_disabled': true,
          'is_sorting': 0
        }
      ]
    };
    return this.on('reset', this.resetMeta, this);
  }
});
