// Generated by CoffeeScript 1.4.0
var ApprovedDrugClinicalCandidateList;

ApprovedDrugClinicalCandidateList = Backbone.Collection.extend({
  model: ApprovedDrugClinicalCandidate,
  fetch2: function() {
    var base_url2, collection, drug_mechanisms, getDrugMechanisms;
    console.log(this.url);
    collection = this;
    drug_mechanisms = {};
    getDrugMechanisms = $.getJSON(this.url, function(data) {
      return drug_mechanisms = data.mechanisms;
    });
    getDrugMechanisms.fail(function() {
      return this.trigger('error');
    });
    base_url2 = 'https://www.ebi.ac.uk/chembl/api/data/molecule.json?molecule_chembl_id__in=';
    return getDrugMechanisms.done(function() {
      var dm, getMoleculesInfo, getMoleculesInfoUrl, molecules_list;
      molecules_list = ((function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = drug_mechanisms.length; _i < _len; _i++) {
          dm = drug_mechanisms[_i];
          _results.push(dm.molecule_chembl_id);
        }
        return _results;
      })()).join(',');
      getMoleculesInfoUrl = base_url2 + molecules_list + '&order_by=molecule_chembl_id&limit=1000';
      getMoleculesInfo = $.getJSON(getMoleculesInfoUrl, function(data) {
        var i, mol, molecules, _i, _len;
        molecules = data.molecules;
        i = 0;
        for (_i = 0, _len = molecules.length; _i < _len; _i++) {
          mol = molecules[_i];
          drug_mechanisms[i].max_phase = mol.max_phase;
          drug_mechanisms[i].pref_name = mol.pref_name;
          i++;
        }
        return collection.reset(drug_mechanisms);
      });
      return getMoleculesInfo.fail(function() {
        return console.log('failed2');
      });
    });
  }
});
