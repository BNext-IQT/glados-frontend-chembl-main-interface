// Generated by CoffeeScript 1.4.0
var TargetHierarchyNode;

TargetHierarchyNode = Backbone.Model.extend({
  checkMeAndMyDescendants: function() {
    var nodeModel, _i, _len, _ref;
    this.set('selected', true);
    this.set('incomplete', false);
    _ref = this.get('children').models;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      nodeModel = _ref[_i];
      nodeModel.checkMeAndMyDescendants();
    }
    return this.verifyMyAncestryIsComplete();
  },
  unCheckMeAndMyDescendants: function() {
    var nodeModel, _i, _len, _ref;
    this.set('selected', false);
    _ref = this.get('children').models;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      nodeModel = _ref[_i];
      nodeModel.unCheckMeAndMyDescendants();
    }
    return this.verifyMyAncestryIsComplete();
  },
  verifyMyAncestryIsComplete: function() {
    if (this.get('parent') != null) {
      return this.get('parent').checkMeAndMyAncestryIsComplete();
    }
  },
  checkMeAndMyAncestryIsComplete: function() {
    var num_children_incomplete, num_children_unchecked;
    num_children_incomplete = _.filter(this.get('children').models, function(model) {
      return model.get('incomplete') === true;
    }).length;
    num_children_unchecked = _.filter(this.get('children').models, function(model) {
      return !model.get('selected') === true;
    }).length;
    if (num_children_unchecked === this.get('children').models.length && num_children_incomplete === 0) {
      this.set('selected', false);
      this.set('incomplete', false);
    } else if (num_children_unchecked === 0 && num_children_incomplete === 0) {
      this.set('incomplete', false);
      this.set('selected', true);
    } else {
      this.set('incomplete', true);
      this.set('selected', false);
    }
    if (this.get('parent') != null) {
      return this.get('parent').checkMeAndMyAncestryIsComplete();
    }
  },
  collapseMeAndMyDescendants: function() {
    var nodeModel, _i, _len, _ref, _results;
    this.collapseMe();
    _ref = this.get('children').models;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      nodeModel = _ref[_i];
      _results.push(nodeModel.collapseMeAndMyDescendants());
    }
    return _results;
  },
  expandMeAndMyDescendants: function() {
    var nodeModel, _i, _len, _ref, _results;
    this.expandMe();
    _ref = this.get('children').models;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      nodeModel = _ref[_i];
      _results.push(nodeModel.expandMeAndMyDescendants());
    }
    return _results;
  },
  expandMe: function() {
    var nodeModel, _i, _len, _ref, _results;
    this.set('collapsed', false);
    _ref = this.get('children').models;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      nodeModel = _ref[_i];
      nodeModel.set('show', true);
      _results.push(nodeModel.ensureMyDescendantsAreShown());
    }
    return _results;
  },
  collapseMe: function() {
    var nodeModel, _i, _len, _ref, _results;
    this.set('collapsed', true);
    _ref = this.get('children').models;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      nodeModel = _ref[_i];
      _results.push(nodeModel.hideMeAndMyDescendants());
    }
    return _results;
  },
  hideMeAndMyDescendants: function() {
    var nodeModel, _i, _len, _ref, _results;
    this.set('show', false);
    _ref = this.get('children').models;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      nodeModel = _ref[_i];
      nodeModel.set('show', false);
      _results.push(nodeModel.hideMeAndMyDescendants());
    }
    return _results;
  },
  ensureMyDescendantsAreShown: function() {
    var nodeModel, _i, _len, _ref, _results;
    if (!this.get('collapsed')) {
      _ref = this.get('children').models;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        nodeModel = _ref[_i];
        nodeModel.set('show', true);
        _results.push(nodeModel.ensureMyDescendantsAreShown());
      }
      return _results;
    }
  },
  toggleCollapsed: function() {
    if (this.get('collapsed') === true) {
      this.set('collapsed', false);
      console.log('expanding ' + this.get('name'));
      return this.expandMe();
    } else {
      this.set('collapsed', true);
      console.log('collapsing ' + this.get('name'));
      return this.collapseMe();
    }
  },
  expandMyAncestors: function() {
    var parent;
    parent = this.get('parent');
    if (parent != null) {
      parent.expandMe();
      return parent.expandMyAncestors();
    }
  }
});
