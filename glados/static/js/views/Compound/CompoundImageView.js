// Generated by CoffeeScript 1.4.0
var CompoundImageView;

CompoundImageView = CardView.extend({
  initialize: function() {
    return this.model.on('change', this.render, this);
  },
  render: function() {
    this.renderImage();
    this.initDownloadButtons();
    return this.initZoomModal();
  },
  renderImage: function() {
    var img, img_url;
    if (this.model.get('structure_type') === 'NONE') {
      img_url = '/static/img/structure_not_available.png';
    } else if (this.model.get('structure_type') === 'SEQ') {
      img_url = '/static/img/protein_structure.png';
    } else {
      img_url = 'https://www.ebi.ac.uk/chembl/api/data/image/' + this.model.get('molecule_chembl_id') + '.svg';
    }
    img = $(this.el).find('#Bck-COMP_IMG');
    img.load($.proxy(this.showVisibleContent, this));
    img.error(function() {
      return img.attr('src', '/static/img/structure_not_found.png');
    });
    return img.attr('src', img_url);
  },
  initDownloadButtons: function() {
    var img_url;
    img_url = 'https://www.ebi.ac.uk/chembl/api/data/image/' + this.model.get('molecule_chembl_id');
    $('.CNC-download-png').attr('href', img_url + '.png');
    $('.CNC-download-png').attr('download', this.model.get('molecule_chembl_id') + '.png');
    $('.CNC-download-svg').attr('href', img_url + '.svg');
    return $('.CNC-download-svg').attr('download', this.model.get('molecule_chembl_id') + '.svg');
  },
  initZoomModal: function() {
    var img, modal, title;
    modal = $(this.el).find('#CNC-zoom-modal');
    title = modal.find('h3');
    title.text(this.model.get('molecule_chembl_id'));
    img = modal.find('img');
    img.attr('src', $(this.el).find('#Bck-COMP_IMG').attr('src'));
    return img.attr('alt', 'Structure of ' + this.model.get('molecule_chembl_id'));
  },
  showVisibleContent: function() {
    $(this.el).children('.card-preolader-to-hide').hide();
    return $(this.el).children(':not(.card-preolader-to-hide, .card-load-error, .modal)').show();
  }
});
