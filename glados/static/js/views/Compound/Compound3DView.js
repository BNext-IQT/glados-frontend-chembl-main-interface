// Generated by CoffeeScript 1.4.0
var Compound3DView;

Compound3DView = Backbone.View.extend({
  initialize: function() {
    this.model.on('change', this.render, this);
    return this.getCoords();
  },
  render: function() {
    return MoleculeVisualisator.initVsualisationFromData("render-container", "renderer-canvas", this.model.get('xyz'));
  },
  getCoords: function() {
    var f, getXYZURL, getXZYcontent, molUrl, setXYZToModel, standardInchi, standardInchiB64;
    standardInchi = this.model.get('molecule_structures')['standard_inchi'];
    standardInchiB64 = window.btoa(standardInchi);
    molUrl = 'https://www.ebi.ac.uk/chembl/api/utils/inchi2ctab/' + standardInchiB64;
    getXYZURL = function(data) {
      var ctabB64, xyzUrl;
      ctabB64 = window.btoa(data);
      xyzUrl = 'https://www.ebi.ac.uk/chembl/api/utils/ctab2xyz/' + ctabB64;
      return xyzUrl;
    };
    getXZYcontent = function(url) {
      return $.ajax(url);
    };
    setXYZToModel = function(xyzCoords) {
      return this.model.set('xyz', xyzCoords);
    };
    f = $.proxy(setXYZToModel, this);
    return $.when($.ajax(molUrl)).then(getXYZURL).then(getXZYcontent).then(f);
  }
});
